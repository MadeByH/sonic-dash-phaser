<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ðŸŒ€ Sonic Dash Phaser Game</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      font-family: 'Vazirmatn', sans-serif;
    }
    #start-screen {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    #start-screen h1 {
      font-size: 40px;
      margin-bottom: 20px;
    }
    #start-screen button {
      padding: 15px 30px;
      font-size: 20px;
      background: #00bcd4;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #start-screen button:hover {
      background: #0097a7;
    }
    canvas {
      display: block;
      margin: auto;
      outline: none;
    }
  </style>
</head>
<body>

<div id="start-screen">
  <h1>ðŸŽ® Ø¨Ø§Ø²ÛŒ Ø³ÙˆÙ†ÛŒÚ© Ø¯Ø§Ø´</h1>
  <button onclick="startGame()">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
</div>

<script>
  let game;

  function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    game = new Phaser.Game(config);
  }

  const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 400,
    physics: {
      default: 'arcade',
      arcade: {
        gravity: { y: 1000 },
        debug: false
      }
    },
    scene: { preload, create, update }
  };

  let sonic, cursors, ground, rings, enemies;
  let score = 0, scoreText, gameOver = false;
  let bgMusic;

  function preload() {
    this.load.image('bg', 'https://i.imgur.com/4xjDZP7.png');
    this.load.image('ground', 'https://i.ibb.co/8nR2dRr/desktop-wallpaper-green-hill-zone-sonic-thr-hedghog-green-hill-zone.jpg');
    this.load.image('ring', 'https://i.ibb.co/Qj68Gys5/image.png');
    this.load.image('enemy', 'https://i.imgur.com/lxvNw30.png');
    this.load.spritesheet('sonic', 'https://i.ibb.co/xKgKQZt4/image.png', {
      frameWidth: 48,
      frameHeight: 48
    });
    this.load.audio('bgmusic', 'https://opengameart.org/sites/default/files/8-bit-loop.ogg');
  }

  function create() {
    this.add.tileSprite(0, 0, 800, 400, 'bg').setOrigin(0);

    ground = this.physics.add.staticGroup();
    ground.create(400, 390, 'ground').setScale(2).refreshBody();

    sonic = this.physics.add.sprite(100, 300, 'sonic');
    sonic.setCollideWorldBounds(true);

    this.anims.create({
      key: 'run',
      frames: this.anims.generateFrameNumbers('sonic', { start: 0, end: 5 }),
      frameRate: 10,
      repeat: -1
    });

    rings = this.physics.add.group();
    enemies = this.physics.add.group();

    this.time.addEvent({ delay: 1200, callback: spawnRing, callbackScope: this, loop: true });
    this.time.addEvent({ delay: 3000, callback: spawnEnemy, callbackScope: this, loop: true });

    cursors = this.input.keyboard.createCursorKeys();

    this.physics.add.collider(sonic, ground);
    this.physics.add.overlap(sonic, rings, collectRing, null, this);
    this.physics.add.collider(sonic, enemies, hitEnemy, null, this);

    scoreText = this.add.text(16, 16, 'ðŸ’ Ø­Ù„Ù‚Ù‡â€ŒÙ‡Ø§: 0', {
      fontSize: '24px',
      fill: '#fff',
      fontFamily: 'Vazirmatn'
    });

    bgMusic = this.sound.add('bgmusic', { loop: true });
    bgMusic.play();
  }

  function update() {
    if (gameOver) return;

    sonic.play('run', true);

    if (cursors.up.isDown && sonic.body.touching.down) {
      sonic.setVelocityY(-500);
    }

    rings.children.iterate(ring => {
      ring.x -= 5;
      if (ring.x < -50) ring.destroy();
    });

    enemies.children.iterate(enemy => {
      enemy.x -= 6;
      if (enemy.x < -50) enemy.destroy();
    });
  }

  function spawnRing() {
    const y = Phaser.Math.Between(200, 350);
    const ring = rings.create(850, y, 'ring');
    ring.setScale(0.5);
    ring.setCircle(16);
  }

  function spawnEnemy() {
    const enemy = enemies.create(850, 345, 'enemy');
    enemy.setImmovable(true);
    enemy.body.setSize(40, 40);
  }

  function collectRing(player, ring) {
    ring.destroy();
    score += 1;
    scoreText.setText('ðŸ’ Ø­Ù„Ù‚Ù‡â€ŒÙ‡Ø§: ' + score);
  }

  function hitEnemy(player, enemy) {
    this.physics.pause();
    player.setTint(0xff0000);
    gameOver = true;
    bgMusic.stop();
    scoreText.setText('ðŸ’€ Ø¨Ø§Ø®ØªÛŒ! Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ: ' + score);
  }
</script>

</body>
</html>
